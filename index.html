<!DOCTYPE html>
<html>
<head>
<title>OpenWhateverMap :: An Open Awsumnez Map</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet-src.js"></script>
<script src="leaflet-hash.js"></script>
<style>html, body, #map { margin: 0; height: 100%; }</style>
</head>
<body>
<div id="map"></div>
<script type="text/javascript">
var WhateverTileLayer = L.TileLayer.extend({
    _tileUrls: {},

    getTileUrl: function (coords) {
        var data = {
            r: L.Browser.retina ? '@2x' : '',
            s: this._getSubdomain(coords),
            x: coords.x,
            y: coords.y,
            z: this._getZoomForUrl()
        };
        if (this._map && !this._map.options.crs.infinite) {
            var invertedY = this._globalTileRange.max.y - coords.y;
            if (this.options.tms) {
                data['y'] = invertedY;
            }
            data['-y'] = invertedY;
        }

        var i = Math.floor(Math.random() * this._url.length);
        this._tileUrls[data.x+','+data.y+','+data.z] = i;
        return L.Util.template(this._url[i][0], L.Util.extend(data, this.options));
    },

    getTileData: function(latlng) {
        var zoom = this._getZoomForUrl(),
            pixel = map.project([latlng.lat, latlng.lng], zoom).floor(),
            tileSize = this.getTileSize(),
            coords = pixel.unscaleBy(tileSize).floor(),
            i = this._tileUrls[coords.x+','+coords.y+','+zoom];
        return this._url[i];
    }
});

var map = L.map('map', { minZoom: 3, maxZoom: 18 }).setView([28, 18], 3);
map.attributionControl.setPrefix("");
var whateverLayer = new WhateverTileLayer([
  ['https://tile.openstreetmap.org/{z}/{x}/{y}.png', 'OpenStreetMap Carto', 'OpenStreetMap', 'https://www.openstreetmap.org/'],
  ['http://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png', 'Humanitarian', 'Humanitarian OpenStreetMap Team', 'http://hot.openstreetmap.org/'],
  // ['http://korona.geog.uni-heidelberg.de/tiles/roads/x={x}&y={y}&z={z}', 'MapSurfer.NET', 'GIScience Research Group @ Heidelberg University', 'http://giscience.uni-hd.de/'],
  ['http://korona.geog.uni-heidelberg.de/tiles/roadsg/x={x}&y={y}&z={z}', 'MapSurfer.NET Gray', 'GIScience Research Group @ Heidelberg University', 'http://giscience.uni-hd.de/'],
  ['http://{s}.tile.openstreetmap.de/tiles/osmde/{z}/{x}/{y}.png', 'OpenStreetMap.de', 'OpenStreetMap Deutschland', 'https://www.openstreetmap.de/'],
  ['http://{s}.tile.openstreetmap.fr/osmfr/{z}/{x}/{y}.png', 'OpenStreetMap.fr', 'OpenStreetMap France', 'https://www.openstreetmap.fr/'],
  ['http://4umaps.eu/{z}/{x}/{y}.png', '4UMaps', '4UMaps', 'http://www.4umaps.eu'],
  ['http://{s}.tiles.maps.sputnik.ru/{z}/{x}/{y}.png', 'Sputnik', 'Sputnik', 'https://maps.sputnik.ru/'],
  ['http://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}.png', 'CartoDB Dark Matter', 'Carto', 'https://carto.com/attribution/#basemaps'],
  ['http://{s}.tile.stamen.com/toner/{z}/{x}/{y}.png', 'Toner', 'Stamen', 'http://maps.stamen.com/'],
  ['http://{s}.tile.stamen.com/watercolor/{z}/{x}/{y}.jpg', 'Watercolor', 'Stamen', 'http://maps.stamen.com/'],
  ['http://tileserver.memomaps.de/tilegen/{z}/{x}/{y}.png', 'ÖPNV Karte', 'ÖPNV Karte', 'https://www.öpnvkarte.de/'],
  ['http://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', 'OpenTopoMap', 'OpenTopoMap', 'https://opentopomap.org/'],

  // Please do not steal my API key for Thunderforest maps!
  ['https://{s}.tile.thunderforest.com/cycle/{z}/{x}/{y}.png?apikey=41f4f936f1d148f69cbd100812875c88', 'OpenCycleMap', 'Thunderforest', 'https://thunderforest.com/'],
  ['https://{s}.tile.thunderforest.com/transport-dark/{z}/{x}/{y}.png?apikey=41f4f936f1d148f69cbd100812875c88', 'Transport Dark', 'Thunderforest', 'https://thunderforest.com/'],
  ['https://{s}.tile.thunderforest.com/spinal-map/{z}/{x}/{y}.png?apikey=41f4f936f1d148f69cbd100812875c88', 'Spinal Map', 'Thunderforest', 'https://thunderforest.com/'],
  ['https://{s}.tile.thunderforest.com/pioneer/{z}/{x}/{y}.png?apikey=41f4f936f1d148f69cbd100812875c88', 'Pioneer', 'Thunderforest', 'https://thunderforest.com/'],
  ['https://{s}.tile.thunderforest.com/mobile-atlas/{z}/{x}/{y}.png?apikey=41f4f936f1d148f69cbd100812875c88', 'Mobile Atlas', 'Thunderforest', 'https://thunderforest.com/']
  ], { attribution: 'Map &copy; <a href=\"http://openstreetmap.org\">OpenStreetMap</a> | Click on the map for tile authors' }).addTo(map);

var hash = new L.Hash(map);

lastUrl = '';
map.on('click', function(e) {
  var data = whateverLayer.getTileData(e.latlng);
  if (!data)
    return;
  if (lastUrl == data[0]) {
    map.closePopup();
    lastUrl = '';
  } else {
    lastUrl = data[0];
    map.openPopup('<b>'+data[1]+'</b><br>&copy; <a target="owm" href="'+data[3]+'">'+data[2]+'</a>', e.latlng);
  }
});
map.on('zoomstart', function() { map.closePopup(); lastUrl = ''; });
</script>
</body>
</html>
